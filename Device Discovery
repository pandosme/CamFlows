[{"id":"20f3e122.c1f886","type":"ui_button","z":"5867f876.784378","name":"Refresh","group":"a4eae31f.286568","order":1,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":140,"y":80,"wires":[["36ca516a.7cf0ce","d36dea47.69b7a"]]},{"id":"c234c6ea.9e31f","type":"Axis Discovery","z":"5867f876.784378","name":"","x":360,"y":700,"wires":[["1cd64f9d.5a56a"]]},{"id":"90faac2c.a79cf8","type":"mongodb2 in","z":"5867f876.784378","service":"_ext_","configNode":"a2b65a4.ac5fc28","name":"","collection":"discovery","operation":"aggregate.toArray","x":590,"y":80,"wires":[["41069d9b.e2b4bc"]]},{"id":"41069d9b.e2b4bc","type":"ui_table","z":"5867f876.784378","group":"a4eae31f.286568","name":"","order":4,"width":"17","height":"9","columns":[{"field":"name","title":"Name","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"mqttClient","title":"MQTT Client","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"address","title":"Address","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"serial","title":"Serial","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"deployed","title":"Deployed","width":"","align":"left","formatter":"tickCross","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":830,"y":80,"wires":[["90faac2c.a79cf8","d8f57861.28dae8","89880605.ddf7b8"]]},{"id":"a1a3e2cc.d6afb","type":"link in","z":"5867f876.784378","name":"Refresh Table","links":["e92ca767.db2c38","2d20767e.ae14da","93f5055c.3d87b8","af2b686a.443d2"],"x":195,"y":120,"wires":[["90faac2c.a79cf8"]]},{"id":"4b53d7f8.d375b8","type":"comment","z":"5867f876.784378","name":"Refresh","info":"","x":130,"y":120,"wires":[]},{"id":"1cd64f9d.5a56a","type":"function","z":"5867f876.784378","name":"Camera","func":"if( !msg.payload.hasOwnProperty(\"serial\") || msg.payload.serial.length < 5)\n    return;\nmsg.payload = {\n    serial: msg.payload.serial,\n    address: msg.payload.address,\n    name: msg.payload.name,\n    port: msg.payload.port\n}\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":700,"wires":[["8ff788de.5c5698"]]},{"id":"cdf1f6c2.f13ac","type":"ui_switch","z":"5867f876.784378","name":"","label":"Discovery","tooltip":"","group":"a4eae31f.286568","order":2,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"start","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stop","offvalueType":"str","officon":"","offcolor":"","x":160,"y":700,"wires":[["c234c6ea.9e31f"]]},{"id":"7f6c4508.d28e2c","type":"comment","z":"5867f876.784378","name":"Refresh","info":"","x":1170,"y":700,"wires":[]},{"id":"51f7da15.705cac","type":"link out","z":"5867f876.784378","name":"","links":["536cb00.10115d"],"x":1095,"y":80,"wires":[]},{"id":"45cac38b.42b184","type":"comment","z":"5867f876.784378","name":"Edit","info":"","x":1170,"y":80,"wires":[]},{"id":"536cb00.10115d","type":"link in","z":"5867f876.784378","name":"Edit Camera","links":["51f7da15.705cac"],"x":235,"y":340,"wires":[["b0b7120f.82f16","841866af.e78dd8"]]},{"id":"980c5cb.b23702","type":"comment","z":"5867f876.784378","name":"Edit","info":"","x":150,"y":340,"wires":[]},{"id":"841866af.e78dd8","type":"ui_template","z":"5867f876.784378","group":"a4eae31f.286568","name":"Info","order":5,"width":"6","height":"2","format":"<h3>{{msg.payload.name}}</h3>\n<h3>{{msg.payload.serial}}</h3>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":490,"y":300,"wires":[[]]},{"id":"8ff788de.5c5698","type":"function","z":"5867f876.784378","name":"Update","func":"msg.payload = [\n    { serial: msg.payload.serial },\n    {\n        '$set': msg.payload\n    },\n    { upsert: true }\n];\nreturn msg;\n","outputs":1,"noerr":0,"x":710,"y":700,"wires":[["d1b125cc.b84e78","86d4c442.582cd8"]]},{"id":"d1b125cc.b84e78","type":"mongodb2 in","z":"5867f876.784378","service":"_ext_","configNode":"a2b65a4.ac5fc28","name":"","collection":"discovery","operation":"update","x":920,"y":700,"wires":[["93f5055c.3d87b8"]]},{"id":"93f5055c.3d87b8","type":"link out","z":"5867f876.784378","name":"","links":["a1a3e2cc.d6afb"],"x":1095,"y":700,"wires":[]},{"id":"8a4ff7f.449c388","type":"mqtt in","z":"5867f876.784378","name":"","topic":"connect/#","qos":"2","datatype":"json","broker":"4d14423d.333954","x":160,"y":760,"wires":[["237dcd7b.a30202"]]},{"id":"237dcd7b.a30202","type":"function","z":"5867f876.784378","name":"Camera","func":"if( msg.payload.connected === false )\n    return;\n    \nmsg.payload = {\n    serial: msg.payload.serial,\n    name: msg.payload.client,\n    address: msg.payload.IPv4,\n    mqttClient: msg.payload.client\n}\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":760,"wires":[["8ff788de.5c5698"]]},{"id":"86d4c442.582cd8","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":780,"wires":[]},{"id":"b0b7120f.82f16","type":"ui_form","z":"5867f876.784378","name":"","label":"","group":"a4eae31f.286568","order":6,"width":"6","height":"5","options":[{"label":"User","value":"user","type":"text","required":true,"rows":null},{"label":"Password","value":"password","type":"password","required":true,"rows":null}],"formValue":{"user":"","password":""},"payload":"","submit":"Deploy","cancel":"","topic":"","x":350,"y":340,"wires":[["333e2b21.2bca2c"]]},{"id":"c89f4144.c7f018","type":"comment","z":"5867f876.784378","name":"Reset","info":"","x":150,"y":280,"wires":[]},{"id":"8019455d.4f82f","type":"function","z":"5867f876.784378","name":"Reset","func":"msg.payload = \"\"\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":280,"wires":[["841866af.e78dd8"]]},{"id":"13430900.e015b7","type":"link in","z":"5867f876.784378","name":"","links":["c4bced2a.33a06"],"x":235,"y":280,"wires":[["8019455d.4f82f"]]},{"id":"c4bced2a.33a06","type":"link out","z":"5867f876.784378","name":"","links":["13430900.e015b7"],"x":395,"y":40,"wires":[]},{"id":"333e2b21.2bca2c","type":"function","z":"5867f876.784378","name":"Deploy","func":"edit = flow.get(\"edit\")\nif(!edit)\n    return\n\nmsg.camera = {\n    serial: edit.serial,\n    name: edit.name,\n    address: edit.address\n}\n    \nmsg.user = msg.payload.user\nmsg.password = msg.payload.password\nmsg.address = edit.address;\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":340,"wires":[["90ada759.4c4108","e7b34deb.fd1678"]]},{"id":"d8f57861.28dae8","type":"function","z":"5867f876.784378","name":"Edit","func":"flow.set(\"edit\",msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":80,"wires":[["51f7da15.705cac","4f8a338a.b2fe84"]]},{"id":"36ca516a.7cf0ce","type":"function","z":"5867f876.784378","name":"Reset","func":"flow.set(\"edit\")\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":40,"wires":[["c4bced2a.33a06"]]},{"id":"90ada759.4c4108","type":"Axis Camera","z":"5867f876.784378","name":"Check Authentication","account":"519451ca.77388","address":"","action":"Get Properties","data":"brand","format":"default","x":680,"y":340,"wires":[["a58fa124.f041f","9e4e7d86.f5cb6"]]},{"id":"a58fa124.f041f","type":"function","z":"5867f876.784378","name":"Error","func":"if( msg.error === false)\n    return;\nmsg.payload = \"Unable to deploy device.  Check addres, user & password\"\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":340,"wires":[["684421a7.dccd68"]]},{"id":"9e4e7d86.f5cb6","type":"function","z":"5867f876.784378","name":"OK","func":"if( msg.error === true)\n    return;\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":380,"wires":[["171b7fe7.51c5d8","33b1abc5.83e5bc"]]},{"id":"684421a7.dccd68","type":"ui_toast","z":"5867f876.784378","position":"dialog","displayTime":"5","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1050,"y":340,"wires":[[]]},{"id":"171b7fe7.51c5d8","type":"function","z":"5867f876.784378","name":"Properties","func":"msg.payload = \"properties\"\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":420,"wires":[["709df8c8.cca9e"]]},{"id":"709df8c8.cca9e","type":"Axis Camera","z":"5867f876.784378","name":"","account":"519451ca.77388","address":"","action":"Get Properties","data":"","format":"default","x":1270,"y":420,"wires":[["46026c39.951374"]]},{"id":"477d0892.3cfe2","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":420,"wires":[]},{"id":"46026c39.951374","type":"function","z":"5867f876.784378","name":"Parse","func":"if(msg.error){\n    node.warn(msg.payload)\n    return;\n}\n\nmsg.camera.platform = msg.payload.System.Architecture;\nmsg.camera.chip = msg.payload.System.Soc;\nmsg.camera.firmware = msg.payload.Firmware.Version;\nmsg.camera.serial = msg.payload.System.SerialNumber\n\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":420,"wires":[["477d0892.3cfe2","37c7a217.42626e"]]},{"id":"37c7a217.42626e","type":"function","z":"5867f876.784378","name":"Brand","func":"msg.payload = \"brand\"\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":460,"wires":[["fdcb055b.53e848"]]},{"id":"fdcb055b.53e848","type":"Axis Camera","z":"5867f876.784378","name":"","account":"519451ca.77388","address":"","action":"Get Properties","data":"","format":"default","x":1270,"y":460,"wires":[["73dceaf7.deac3c"]]},{"id":"d59559bf.d68ea8","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":460,"wires":[]},{"id":"73dceaf7.deac3c","type":"function","z":"5867f876.784378","name":"Parse","func":"if(msg.error){\n    node.warn(msg.payload)\n    return;\n}\n\nmsg.camera.model = msg.payload.ProdNbr;\nmsg.camera.type = msg.payload.ProdType;\n\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":460,"wires":[["d59559bf.d68ea8","be5c632e.b3754"]]},{"id":"be5c632e.b3754","type":"function","z":"5867f876.784378","name":"Network","func":"msg.payload = \"network\"\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":500,"wires":[["ce2debcb.59fa78"]]},{"id":"ce2debcb.59fa78","type":"Axis Camera","z":"5867f876.784378","name":"","account":"519451ca.77388","address":"","action":"Get Properties","data":"","format":"default","x":1270,"y":500,"wires":[["5b803d01.a88174"]]},{"id":"5b803d01.a88174","type":"function","z":"5867f876.784378","name":"Parse","func":"if(msg.error){\n    node.warn(msg.payload)\n    return;\n}\n\nmsg.camera.mac = msg.payload.eth0.MACAddress\nmsg.camera.hostName = msg.payload.VolatileHostName.HostName\nmsg.camera.ipv4 = msg.payload.eth0.IPAddress\n\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":500,"wires":[["f2452342.0d2148","16724888.447adf"]]},{"id":"f2452342.0d2148","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":500,"wires":[]},{"id":"16724888.447adf","type":"function","z":"5867f876.784378","name":"Sensor","func":"msg.payload = \"ImageSource.I0\"\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":540,"wires":[["464f4747.6a4f18"]]},{"id":"464f4747.6a4f18","type":"Axis Camera","z":"5867f876.784378","name":"","account":"519451ca.77388","address":"","action":"Get Properties","data":"","format":"default","x":1270,"y":540,"wires":[["73ed8c67.039a9c"]]},{"id":"73ed8c67.039a9c","type":"function","z":"5867f876.784378","name":"Parse","func":"if(msg.error){\n    node.warn(msg.payload)\n    return;\n}\n\nmsg.camera.capture = msg.payload.I0.CaptureFrequency\nmsg.camera.rotation = parseInt(msg.payload.I0.Rotation)\nmsg.camera.aspect = msg.payload.I0.Sensor.AspectRatio\n\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":540,"wires":[["d4172a9f.63889","53c27967.9b9878","69b136a7.b5d5e"]]},{"id":"d4172a9f.63889","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":540,"wires":[]},{"id":"53c27967.9b9878","type":"function","z":"5867f876.784378","name":"Update","func":"msg.payload = [\n    { serial: msg.camera.serial },\n    {\n        '$set': msg.camera\n    },\n    { upsert: true }\n];\nreturn msg;\n","outputs":1,"noerr":0,"x":1620,"y":620,"wires":[["d0c03e65.36fb18"]]},{"id":"d0c03e65.36fb18","type":"mongodb2 in","z":"5867f876.784378","service":"_ext_","configNode":"a2b65a4.ac5fc28","name":"","collection":"cameras","operation":"update","x":1830,"y":620,"wires":[[]]},{"id":"69b136a7.b5d5e","type":"function","z":"5867f876.784378","name":"Update","func":"msg.payload = [\n    { serial: msg.camera.serial },\n    {\n        '$set': {\n            name: msg.camera.name,\n            deployed: true\n        }\n    }\n];\nreturn msg;\n","outputs":1,"noerr":0,"x":1620,"y":580,"wires":[["c2d72656.98e8c8"]]},{"id":"c2d72656.98e8c8","type":"mongodb2 in","z":"5867f876.784378","service":"_ext_","configNode":"a2b65a4.ac5fc28","name":"","collection":"discovery","operation":"update","x":1830,"y":580,"wires":[["af2b686a.443d2"]]},{"id":"af2b686a.443d2","type":"link out","z":"5867f876.784378","name":"","links":["a1a3e2cc.d6afb"],"x":1995,"y":580,"wires":[]},{"id":"1af4b19.4dfb8ce","type":"comment","z":"5867f876.784378","name":"Refresh","info":"","x":2070,"y":580,"wires":[]},{"id":"4f8a338a.b2fe84","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1150,"y":140,"wires":[]},{"id":"89880605.ddf7b8","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":40,"wires":[]},{"id":"e7b34deb.fd1678","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":640,"y":300,"wires":[]},{"id":"33b1abc5.83e5bc","type":"debug","z":"5867f876.784378","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1030,"y":380,"wires":[]},{"id":"d36dea47.69b7a","type":"function","z":"5867f876.784378","name":"Filter","func":"return msg;","outputs":1,"noerr":0,"x":290,"y":80,"wires":[["90faac2c.a79cf8"]]},{"id":"a4eae31f.286568","type":"ui_group","z":"","name":"List","tab":"1d548437.854ae4","disp":false,"width":"24","collapse":false},{"id":"a2b65a4.ac5fc28","type":"mongodb2","z":"","uri":"mongodb://localhost:27017/inventory","name":"Inventory","options":"","parallelism":"-1"},{"id":"4d14423d.333954","type":"mqtt-broker","z":"","name":"Local","broker":"192.168.254.199","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"519451ca.77388","type":"Camera Account","z":"","name":"Hackaton","protocol":"http"},{"id":"1d548437.854ae4","type":"ui_tab","z":"","name":"Device Discovery","icon":"dashboard","order":5,"disabled":false,"hidden":false}]

[
    {
        "id": "874e5624d1b709a5",
        "type": "tab",
        "label": "Firmware upgrade",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d48f037796138a6f",
        "type": "group",
        "z": "874e5624d1b709a5",
        "name": "Refresh Information",
        "style": {
            "stroke": "#000000",
            "fill": "#ffffbf",
            "label": true
        },
        "nodes": [
            "fb21015c2a1cd268",
            "f092ddcd618c369e",
            "f717625ba3b4bcdf",
            "c0aa0d7dc5e30e0d",
            "95ab10886ae91ab7",
            "614b47cc5644c7c0",
            "1f39517eccb099f1",
            "9cac5406b6e253c3",
            "89aca8e617d907bd",
            "54e276c2a7ea94a0",
            "7e87ff727d5c5f4d",
            "bc902889375ffc78"
        ],
        "x": 314,
        "y": 199,
        "w": 812,
        "h": 382
    },
    {
        "id": "885f6b0fd35850f0",
        "type": "group",
        "z": "874e5624d1b709a5",
        "name": "Download latest if needed",
        "style": {
            "label": true,
            "stroke": "#000000",
            "fill": "#bfdbef",
            "color": "#000000"
        },
        "nodes": [
            "bb398b21157061bc",
            "491121e20872c641",
            "c329b24abc7b9184",
            "18f2a6b7a0a7b73a",
            "8627d456b4bcb113",
            "2c0c836a025d539f",
            "f7dd7834d2987a1c",
            "4735afecbf76ac43",
            "df0c46fcf74dd122",
            "8faf9f06664e6d79"
        ],
        "x": 314,
        "y": 639,
        "w": 812,
        "h": 242
    },
    {
        "id": "919242b0e0657f89",
        "type": "group",
        "z": "874e5624d1b709a5",
        "name": "Upgrade",
        "style": {
            "stroke": "#000000",
            "fill": "#e3f3d3",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "a3facbae2804b3fd",
            "b6d74bb6238ef2cf",
            "01e1817631b84c25",
            "189868e0177bd459",
            "d63d809aeee84778",
            "d860407e7bd243c4",
            "6b55a99bafde02e7",
            "a4e36f92de6a4ba9"
        ],
        "x": 314,
        "y": 939,
        "w": 732,
        "h": 202
    },
    {
        "id": "bc902889375ffc78",
        "type": "junction",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "x": 1100,
        "y": 400,
        "wires": [
            [
                "9cac5406b6e253c3",
                "94da8e478db0991f"
            ]
        ]
    },
    {
        "id": "df0c46fcf74dd122",
        "type": "junction",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "x": 1100,
        "y": 740,
        "wires": [
            [
                "eb370c20b9efbbcc"
            ]
        ]
    },
    {
        "id": "8faf9f06664e6d79",
        "type": "junction",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "x": 1000,
        "y": 800,
        "wires": [
            [
                "df0c46fcf74dd122"
            ]
        ]
    },
    {
        "id": "a4e36f92de6a4ba9",
        "type": "junction",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "x": 1020,
        "y": 980,
        "wires": [
            [
                "65b635d640934c28"
            ]
        ]
    },
    {
        "id": "bb398b21157061bc",
        "type": "exec",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 390,
        "y": 820,
        "wires": [
            [],
            [],
            [
                "f7dd7834d2987a1c"
            ]
        ]
    },
    {
        "id": "c329b24abc7b9184",
        "type": "delay",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1020,
        "y": 680,
        "wires": [
            [
                "2c0c836a025d539f"
            ]
        ]
    },
    {
        "id": "18f2a6b7a0a7b73a",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 680,
        "wires": [
            [
                "c329b24abc7b9184"
            ]
        ]
    },
    {
        "id": "78de28e79b82b4c6",
        "type": "mqtt out",
        "z": "874e5624d1b709a5",
        "name": "axis/upgrade/+",
        "topic": "",
        "qos": "0",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "de0debe784ae927d",
        "x": 640,
        "y": 100,
        "wires": []
    },
    {
        "id": "d1967be45ef0809d",
        "type": "inject",
        "z": "874e5624d1b709a5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 00 * * *",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 240,
        "wires": [
            [
                "7e87ff727d5c5f4d"
            ]
        ]
    },
    {
        "id": "fb21015c2a1cd268",
        "type": "Axis device",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "preset": "a5d60ef5587cc8fc",
        "action": "Device Info",
        "cgi": "",
        "data": "",
        "options": "",
        "filename": "",
        "x": 410,
        "y": 300,
        "wires": [
            [
                "f092ddcd618c369e"
            ]
        ]
    },
    {
        "id": "f092ddcd618c369e",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 300,
        "wires": [
            [
                "f717625ba3b4bcdf",
                "b2eb2723441d2a8d"
            ]
        ]
    },
    {
        "id": "f717625ba3b4bcdf",
        "type": "file in",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 440,
        "y": 360,
        "wires": [
            [
                "614b47cc5644c7c0"
            ]
        ]
    },
    {
        "id": "c0aa0d7dc5e30e0d",
        "type": "catch",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "scope": [
            "f717625ba3b4bcdf"
        ],
        "uncaught": false,
        "x": 390,
        "y": 400,
        "wires": [
            [
                "1f39517eccb099f1"
            ]
        ]
    },
    {
        "id": "95ab10886ae91ab7",
        "type": "file",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 780,
        "y": 400,
        "wires": [
            [
                "bc902889375ffc78"
            ]
        ]
    },
    {
        "id": "614b47cc5644c7c0",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "downloaded",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 360,
        "wires": [
            [
                "bc902889375ffc78"
            ]
        ]
    },
    {
        "id": "1f39517eccb099f1",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "downloaded",
                "pt": "flow",
                "to": "Undefined",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Undefined",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 400,
        "wires": [
            [
                "95ab10886ae91ab7"
            ]
        ]
    },
    {
        "id": "9cac5406b6e253c3",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "Get latest version",
        "func": "var model = flow.get(\"device\").model.replace(/ /g, \"_\");\nmsg.url = \"http://ftp.axis.com/pub_soft/MPQT/\" + model + \"/latest/ver.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 480,
        "wires": [
            [
                "89aca8e617d907bd"
            ]
        ]
    },
    {
        "id": "89aca8e617d907bd",
        "type": "http request",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 630,
        "y": 480,
        "wires": [
            [
                "54e276c2a7ea94a0",
                "f5619d9a0561d396"
            ]
        ]
    },
    {
        "id": "54e276c2a7ea94a0",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "Initialize",
        "func": "if(msg.statusCode >= 400) {\n    flow.set(\"latest\",\"Error\");\n    node.error(\"Axis FTP responded \" + msg.statusCode,msg);\n    return;\n}\n\nflow.set(\"latest\",msg.payload);\n\nvar busy = flow.get(\"busy\") || false;\nflow.set(\"busy\",busy);\nflow.set(\"message\",\"Info updated\");\nif( flow.get(\"device\").authenticated === false )\n    flow.set(\"message\",\"Error: Device credentials unautorized.  Check user/password\");\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 540,
        "wires": [
            [
                "84016e6df0cd93a2"
            ]
        ]
    },
    {
        "id": "134e37ec28676dd3",
        "type": "link in",
        "z": "874e5624d1b709a5",
        "name": "link in 53",
        "links": [
            "84016e6df0cd93a2",
            "eb370c20b9efbbcc",
            "65b635d640934c28"
        ],
        "x": 115,
        "y": 100,
        "wires": [
            [
                "628a72aff67e70e4"
            ]
        ]
    },
    {
        "id": "84016e6df0cd93a2",
        "type": "link out",
        "z": "874e5624d1b709a5",
        "name": "link out 41",
        "mode": "link",
        "links": [
            "134e37ec28676dd3",
            "a46f79e226519254"
        ],
        "x": 1335,
        "y": 540,
        "wires": []
    },
    {
        "id": "2fc3dfc374409a62",
        "type": "comment",
        "z": "874e5624d1b709a5",
        "name": "Refresh",
        "info": "",
        "x": 1230,
        "y": 540,
        "wires": []
    },
    {
        "id": "f18be84b9d77bddc",
        "type": "debug",
        "z": "874e5624d1b709a5",
        "name": "debug 246",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 140,
        "wires": []
    },
    {
        "id": "b2eb2723441d2a8d",
        "type": "debug",
        "z": "874e5624d1b709a5",
        "name": "debug 247",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 300,
        "wires": []
    },
    {
        "id": "94da8e478db0991f",
        "type": "debug",
        "z": "874e5624d1b709a5",
        "name": "debug 248",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 400,
        "wires": []
    },
    {
        "id": "628a72aff67e70e4",
        "type": "function",
        "z": "874e5624d1b709a5",
        "name": "Message",
        "func": "var device = flow.get(\"device\");\n\nmsg.topic =\"axis/upgrade/\" + device.serial;\nmsg.payload = {\n    message: flow.get(\"message\"),\n    group: flow.get(\"group\") || \"Undefined\",\n    location: flow.get(\"location\") || \"Undefined\",\n    serial: device.serial, \n    model: device.model,\n    firmware: device.firmware,\n    downloaded: flow.get(\"downloaded\"),\n    latest:  flow.get(\"latest\"),\n    timestamp: new Date().getTime()\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 100,
        "wires": [
            [
                "f18be84b9d77bddc",
                "78de28e79b82b4c6"
            ]
        ]
    },
    {
        "id": "7e87ff727d5c5f4d",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "d48f037796138a6f",
        "name": "Set Location and Group Here",
        "rules": [
            {
                "t": "set",
                "p": "location",
                "pt": "flow",
                "to": "Home",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "group",
                "pt": "flow",
                "to": "Production",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 240,
        "wires": [
            [
                "fb21015c2a1cd268"
            ]
        ]
    },
    {
        "id": "f5619d9a0561d396",
        "type": "debug",
        "z": "874e5624d1b709a5",
        "name": "debug 249",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 480,
        "wires": []
    },
    {
        "id": "336dfefddeafd4b7",
        "type": "catch",
        "z": "874e5624d1b709a5",
        "name": "",
        "scope": null,
        "uncaught": true,
        "x": 180,
        "y": 140,
        "wires": [
            [
                "58211845d01fb2c2"
            ]
        ]
    },
    {
        "id": "a46f79e226519254",
        "type": "link in",
        "z": "874e5624d1b709a5",
        "name": "link in 54",
        "links": [
            "84016e6df0cd93a2"
        ],
        "x": 205,
        "y": 680,
        "wires": [
            [
                "8627d456b4bcb113"
            ]
        ]
    },
    {
        "id": "8627d456b4bcb113",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "Download latest?",
        "func": "var busy = flow.get(\"busy\") || false;\nif( busy )\n    return;\n    \nif( flow.get(\"latest\") === flow.get(\"downloaded\") )\n    return;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 680,
        "wires": [
            [
                "491121e20872c641"
            ]
        ]
    },
    {
        "id": "2c0c836a025d539f",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "Download",
        "func": "flow.set(\"message\",\"Downloading firmware version \" + flow.get(\"latest\") + \".\");\nflow.set(\"busy\",true);\n\nvar model = flow.get(\"device\").model.replace(/ /g, \"_\");\nvar url = \"http://ftp.axis.com/pub_soft/MPQT/\" + model + \"/latest/\" + model + \".bin\";\n\nmsg.payload = \"curl -o sdcard/firmware/firmware.bin \" + url;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 740,
        "wires": [
            [
                "bb398b21157061bc",
                "df0c46fcf74dd122"
            ]
        ]
    },
    {
        "id": "eb370c20b9efbbcc",
        "type": "link out",
        "z": "874e5624d1b709a5",
        "name": "link out 42",
        "mode": "link",
        "links": [
            "134e37ec28676dd3"
        ],
        "x": 1335,
        "y": 740,
        "wires": []
    },
    {
        "id": "f7dd7834d2987a1c",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "Result",
        "func": "flow.set(\"busy\",false);\n\nif( msg.payload.code !== 0 ) {  //\n    flow.set(\"message\",\"Error: Firmware download failed\");\n    node.send([msg,null]);\n    return \n}\n\nflow.set(\"message\",\"Firmware \" + flow.get(\"latest\") + \" downloaded\");\nflow.set(\"downloaded\",flow.get(\"latest\"));\nmsg.payload =  flow.get(\"latest\");\nnode.send([null,msg]);\n\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 820,
        "wires": [
            [
                "8faf9f06664e6d79"
            ],
            [
                "4735afecbf76ac43"
            ]
        ]
    },
    {
        "id": "4735afecbf76ac43",
        "type": "file",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 800,
        "y": 840,
        "wires": [
            [
                "8faf9f06664e6d79"
            ]
        ]
    },
    {
        "id": "58211845d01fb2c2",
        "type": "function",
        "z": "874e5624d1b709a5",
        "name": "Message",
        "func": "var device = flow.get(\"device\");\n\nmsg.topic =\"axis/upgrade/\" + device.serial;\nmsg.payload = {\n    message: \"Error: \" + msg.error.message,\n    group: flow.get(\"group\") || \"Undefined\",\n    location: flow.get(\"location\") || \"Undefined\",\n    serial: device.serial, \n    model: device.model,\n    firmware: device.firmware,\n    downloaded: flow.get(\"downloaded\"),\n    latest:  flow.get(\"latest\"),\n    timestamp: new Date().getTime()\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 140,
        "wires": [
            [
                "78de28e79b82b4c6",
                "f18be84b9d77bddc"
            ]
        ]
    },
    {
        "id": "dc7bed35ad4ddbd7",
        "type": "mqtt in",
        "z": "874e5624d1b709a5",
        "name": "",
        "topic": "axis/upgrade",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "de0debe784ae927d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 980,
        "wires": [
            [
                "a3facbae2804b3fd"
            ]
        ]
    },
    {
        "id": "a3facbae2804b3fd",
        "type": "function",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "Check to see if upgrade applies",
        "func": "if( flow.get(\"busy\") )\n    return;\n\nif( flow.get(\"device\").firmware === flow.get(\"latest\"))\n    return;\n\nif( msg.payload.hasOwnProperty(\"location\") )\n    if( flow.get(\"location\") != msg.payload.location)\n        return;\n\nif( msg.payload.hasOwnProperty(\"group\") )\n    if( flow.get(\"group\") != msg.payload.group)\n        return;\n\nif( msg.payload.hasOwnProperty(\"model\") )\n    if( flow.get(\"device\").model != msg.payload.model )\n        return;\n\nif( msg.payload.hasOwnProperty(\"serial\") ) {\n    if( typeof msg.payload.serial === \"string\") {\n        if( msg.payload.serial !== flow.get(\"device\").serial) \n            return;\n    } else {\n        if( Array.isArray(msg.payload.serial) ) {\n            var match = false;\n            msg.payload.serial.forEach(function(item){\n                if( item === flow.get(\"device\").serial)\n                    match = true;\n            });\n            if( !match )\n                return;\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 980,
        "wires": [
            [
                "b6d74bb6238ef2cf"
            ]
        ]
    },
    {
        "id": "b6d74bb6238ef2cf",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Firmware upgrade started",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "true",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 980,
        "wires": [
            [
                "a4e36f92de6a4ba9",
                "01e1817631b84c25"
            ]
        ]
    },
    {
        "id": "65b635d640934c28",
        "type": "link out",
        "z": "874e5624d1b709a5",
        "name": "link out 43",
        "mode": "link",
        "links": [
            "134e37ec28676dd3"
        ],
        "x": 1335,
        "y": 980,
        "wires": []
    },
    {
        "id": "13a51156ac974b6b",
        "type": "comment",
        "z": "874e5624d1b709a5",
        "name": "Status",
        "info": "",
        "x": 1230,
        "y": 740,
        "wires": []
    },
    {
        "id": "ed3eb698b7fb3b9f",
        "type": "comment",
        "z": "874e5624d1b709a5",
        "name": "Status",
        "info": "",
        "x": 1230,
        "y": 980,
        "wires": []
    },
    {
        "id": "01e1817631b84c25",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "Firmware file",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "sdcard/firmware/firmware.bin",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "filename",
                "pt": "msg",
                "to": "sdcard/firmware/firmware.bin",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 1040,
        "wires": [
            [
                "189868e0177bd459"
            ]
        ]
    },
    {
        "id": "189868e0177bd459",
        "type": "Axis device",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "",
        "preset": "a5d60ef5587cc8fc",
        "action": "Upgrade firmware",
        "cgi": "",
        "data": "",
        "options": "",
        "filename": "",
        "x": 630,
        "y": 1040,
        "wires": [
            [
                "d63d809aeee84778"
            ]
        ]
    },
    {
        "id": "d63d809aeee84778",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Upgrade complete.  Restarting.",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "false",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1040,
        "wires": [
            [
                "a4e36f92de6a4ba9"
            ]
        ]
    },
    {
        "id": "d860407e7bd243c4",
        "type": "catch",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "",
        "scope": [
            "189868e0177bd459"
        ],
        "uncaught": false,
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "6b55a99bafde02e7"
            ]
        ]
    },
    {
        "id": "6b55a99bafde02e7",
        "type": "change",
        "z": "874e5624d1b709a5",
        "g": "919242b0e0657f89",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Error: Upgrade failed.",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "false",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1100,
        "wires": [
            [
                "a4e36f92de6a4ba9"
            ]
        ]
    },
    {
        "id": "b5f1127af0bf9b5a",
        "type": "comment",
        "z": "874e5624d1b709a5",
        "name": "Version 1.0.0",
        "info": "",
        "x": 170,
        "y": 40,
        "wires": []
    },
    {
        "id": "491121e20872c641",
        "type": "random",
        "z": "874e5624d1b709a5",
        "g": "885f6b0fd35850f0",
        "name": "",
        "low": "1000",
        "high": "21600000",
        "inte": "true",
        "property": "payload",
        "x": 620,
        "y": 680,
        "wires": [
            [
                "18f2a6b7a0a7b73a"
            ]
        ]
    },
    {
        "id": "cbf7f8158feb443c",
        "type": "inject",
        "z": "874e5624d1b709a5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 640,
        "wires": [
            [
                "8627d456b4bcb113"
            ]
        ]
    },
    {
        "id": "de0debe784ae927d",
        "type": "mqtt-broker",
        "name": "MQTT Broker",
        "broker": "10.13.8.20",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "a5d60ef5587cc8fc",
        "type": "Device Access",
        "name": "Localhost",
        "address": "localhost",
        "protocol": "http"
    }
]

[
    {
        "id": "7497b37a51b0ccd4",
        "type": "tab",
        "label": "Firmware upgrade",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "69a6827d7e30ddc7",
        "type": "group",
        "z": "7497b37a51b0ccd4",
        "name": "Refresh Information",
        "style": {
            "stroke": "#000000",
            "fill": "#ffffbf",
            "label": true
        },
        "nodes": [
            "f882660864db6601",
            "03ccbe88b6215127",
            "4009fd33cfa0a014",
            "49653aaa372f465a",
            "65e8f959c9c22845",
            "cc80e30e56062eed",
            "64eba8d373a901d6",
            "27d57d9522ef4b37",
            "febf982927565a3e",
            "a0cae333fb11e90e",
            "2a3c754aed4ab048",
            "14a1170e8a2a5574"
        ],
        "x": 314,
        "y": 199,
        "w": 812,
        "h": 382
    },
    {
        "id": "a34aee74e091cd2b",
        "type": "group",
        "z": "7497b37a51b0ccd4",
        "name": "Download latest if needed",
        "style": {
            "label": true,
            "stroke": "#000000",
            "fill": "#bfdbef",
            "color": "#000000"
        },
        "nodes": [
            "569b327c238cb57e",
            "2ee1f4f830ca9548",
            "9152b30290fdb4a4",
            "c9a7e43d8ae16952",
            "aaf19a5baf1d4032",
            "3215c31d0b13680e",
            "e32d095189265dfb",
            "ea38537980e4336d",
            "24cc0fe57e4c17ba",
            "59720ee692de3a93"
        ],
        "x": 314,
        "y": 639,
        "w": 812,
        "h": 242
    },
    {
        "id": "f2b7a7fd2d8ff58f",
        "type": "group",
        "z": "7497b37a51b0ccd4",
        "name": "Upgrade",
        "style": {
            "stroke": "#000000",
            "fill": "#e3f3d3",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "0b4845eb00c1a767",
            "51babea9b53c89bd",
            "ea657e9184231e0e",
            "756bb201fc53da66",
            "24d4c191cdb02d9f",
            "a508a750a3a8906c",
            "d8d1a3786ddca838",
            "b03989c79406b6de"
        ],
        "x": 314,
        "y": 939,
        "w": 732,
        "h": 202
    },
    {
        "id": "14a1170e8a2a5574",
        "type": "junction",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "x": 1100,
        "y": 400,
        "wires": [
            [
                "27d57d9522ef4b37",
                "765b497efd036aa8"
            ]
        ]
    },
    {
        "id": "24cc0fe57e4c17ba",
        "type": "junction",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "x": 1100,
        "y": 740,
        "wires": [
            [
                "4bae3eb5a8024f98"
            ]
        ]
    },
    {
        "id": "59720ee692de3a93",
        "type": "junction",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "x": 1000,
        "y": 800,
        "wires": [
            [
                "24cc0fe57e4c17ba"
            ]
        ]
    },
    {
        "id": "b03989c79406b6de",
        "type": "junction",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "x": 1020,
        "y": 980,
        "wires": [
            [
                "390b878838b858a3"
            ]
        ]
    },
    {
        "id": "569b327c238cb57e",
        "type": "exec",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 390,
        "y": 820,
        "wires": [
            [],
            [],
            [
                "e32d095189265dfb"
            ]
        ]
    },
    {
        "id": "9152b30290fdb4a4",
        "type": "delay",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1020,
        "y": 680,
        "wires": [
            [
                "3215c31d0b13680e"
            ]
        ]
    },
    {
        "id": "c9a7e43d8ae16952",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 680,
        "wires": [
            [
                "9152b30290fdb4a4"
            ]
        ]
    },
    {
        "id": "6142429506edebf5",
        "type": "mqtt out",
        "z": "7497b37a51b0ccd4",
        "name": "axis/upgrade/+",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "de0debe784ae927d",
        "x": 640,
        "y": 100,
        "wires": []
    },
    {
        "id": "e3072dc93ddc861c",
        "type": "inject",
        "z": "7497b37a51b0ccd4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 00 * * *",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 240,
        "wires": [
            [
                "2a3c754aed4ab048"
            ]
        ]
    },
    {
        "id": "f882660864db6601",
        "type": "Axis device",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "preset": "a5d60ef5587cc8fc",
        "action": "Device Info",
        "cgi": "",
        "data": "",
        "options": "",
        "filename": "",
        "x": 410,
        "y": 300,
        "wires": [
            [
                "03ccbe88b6215127"
            ]
        ]
    },
    {
        "id": "03ccbe88b6215127",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 300,
        "wires": [
            [
                "4009fd33cfa0a014",
                "a7e24bebbde32d81"
            ]
        ]
    },
    {
        "id": "4009fd33cfa0a014",
        "type": "file in",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 440,
        "y": 360,
        "wires": [
            [
                "cc80e30e56062eed"
            ]
        ]
    },
    {
        "id": "49653aaa372f465a",
        "type": "catch",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "scope": [
            "4009fd33cfa0a014"
        ],
        "uncaught": false,
        "x": 390,
        "y": 400,
        "wires": [
            [
                "64eba8d373a901d6"
            ]
        ]
    },
    {
        "id": "65e8f959c9c22845",
        "type": "file",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 780,
        "y": 400,
        "wires": [
            [
                "14a1170e8a2a5574"
            ]
        ]
    },
    {
        "id": "cc80e30e56062eed",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "downloaded",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 360,
        "wires": [
            [
                "14a1170e8a2a5574"
            ]
        ]
    },
    {
        "id": "64eba8d373a901d6",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "downloaded",
                "pt": "flow",
                "to": "Undefined",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Undefined",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 400,
        "wires": [
            [
                "65e8f959c9c22845"
            ]
        ]
    },
    {
        "id": "27d57d9522ef4b37",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "Get latest version",
        "func": "var model = flow.get(\"device\").model.replace(/ /g, \"_\");\nmsg.url = \"http://ftp.axis.com/pub_soft/MPQT/\" + model + \"/latest/ver.txt\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 480,
        "wires": [
            [
                "febf982927565a3e"
            ]
        ]
    },
    {
        "id": "febf982927565a3e",
        "type": "http request",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 630,
        "y": 480,
        "wires": [
            [
                "a0cae333fb11e90e",
                "9e230b8f33f2dc76"
            ]
        ]
    },
    {
        "id": "a0cae333fb11e90e",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "Initialize",
        "func": "if(msg.statusCode >= 400) {\n    flow.set(\"latest\",\"Error\");\n    node.error(\"Axis FTP responded \" + msg.statusCode,msg);\n    return;\n}\n\nflow.set(\"latest\",msg.payload);\n\nvar busy = flow.get(\"busy\") || false;\nflow.set(\"busy\",busy);\nflow.set(\"message\",\"Info updated\");\nif( flow.get(\"device\").authenticated === false )\n    flow.set(\"message\",\"Error: Device credentials unautorized.  Check user/password\");\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 540,
        "wires": [
            [
                "64bb6cb69c58370f"
            ]
        ]
    },
    {
        "id": "aac2c9106397b469",
        "type": "link in",
        "z": "7497b37a51b0ccd4",
        "name": "link in 53",
        "links": [
            "64bb6cb69c58370f",
            "4bae3eb5a8024f98",
            "390b878838b858a3"
        ],
        "x": 115,
        "y": 100,
        "wires": [
            [
                "ca23a46ba217df08"
            ]
        ]
    },
    {
        "id": "64bb6cb69c58370f",
        "type": "link out",
        "z": "7497b37a51b0ccd4",
        "name": "link out 41",
        "mode": "link",
        "links": [
            "aac2c9106397b469",
            "ff9e76d4b967d1f9"
        ],
        "x": 1335,
        "y": 540,
        "wires": []
    },
    {
        "id": "2738fa9daf34a418",
        "type": "comment",
        "z": "7497b37a51b0ccd4",
        "name": "Refresh",
        "info": "",
        "x": 1230,
        "y": 540,
        "wires": []
    },
    {
        "id": "e0aada17e9d47e81",
        "type": "debug",
        "z": "7497b37a51b0ccd4",
        "name": "debug 246",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 140,
        "wires": []
    },
    {
        "id": "a7e24bebbde32d81",
        "type": "debug",
        "z": "7497b37a51b0ccd4",
        "name": "debug 247",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 300,
        "wires": []
    },
    {
        "id": "765b497efd036aa8",
        "type": "debug",
        "z": "7497b37a51b0ccd4",
        "name": "debug 248",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 400,
        "wires": []
    },
    {
        "id": "ca23a46ba217df08",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "name": "Message",
        "func": "var device = flow.get(\"device\");\n\nmsg.topic =\"axis/upgrade/\" + device.serial;\nmsg.payload = {\n    message: flow.get(\"message\"),\n    group: flow.get(\"group\") || \"Undefined\",\n    location: flow.get(\"location\") || \"Undefined\",\n    serial: device.serial, \n    model: device.model,\n    firmware: device.firmware,\n    downloaded: flow.get(\"downloaded\"),\n    latest:  flow.get(\"latest\"),\n    timestamp: new Date().getTime()\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 100,
        "wires": [
            [
                "e0aada17e9d47e81",
                "6142429506edebf5"
            ]
        ]
    },
    {
        "id": "2a3c754aed4ab048",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "69a6827d7e30ddc7",
        "name": "Set Location and Group Here",
        "rules": [
            {
                "t": "set",
                "p": "location",
                "pt": "flow",
                "to": "Somewhere",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "group",
                "pt": "flow",
                "to": "Group 1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 240,
        "wires": [
            [
                "f882660864db6601"
            ]
        ]
    },
    {
        "id": "9e230b8f33f2dc76",
        "type": "debug",
        "z": "7497b37a51b0ccd4",
        "name": "debug 249",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 480,
        "wires": []
    },
    {
        "id": "b61d9a273afb4569",
        "type": "catch",
        "z": "7497b37a51b0ccd4",
        "name": "",
        "scope": null,
        "uncaught": true,
        "x": 180,
        "y": 140,
        "wires": [
            [
                "7b7b65da348de6b9"
            ]
        ]
    },
    {
        "id": "ff9e76d4b967d1f9",
        "type": "link in",
        "z": "7497b37a51b0ccd4",
        "name": "link in 54",
        "links": [
            "64bb6cb69c58370f"
        ],
        "x": 205,
        "y": 680,
        "wires": [
            [
                "aaf19a5baf1d4032"
            ]
        ]
    },
    {
        "id": "aaf19a5baf1d4032",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "Download latest?",
        "func": "var busy = flow.get(\"busy\") || false;\nif( busy )\n    return;\n    \nif( flow.get(\"latest\") === flow.get(\"downloaded\") ) \n    return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 680,
        "wires": [
            [
                "2ee1f4f830ca9548"
            ]
        ]
    },
    {
        "id": "3215c31d0b13680e",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "Download",
        "func": "flow.set(\"message\",\"Downloading firmware version \" + flow.get(\"latest\") + \".\");\nflow.set(\"busy\",true);\n\nvar model = flow.get(\"device\").model.replace(/ /g, \"_\");\nvar url = \"http://ftp.axis.com/pub_soft/MPQT/\" + model + \"/latest/\" + model + \".bin\";\n\nmsg.payload = \"curl -o sdcard/firmware/firmware.bin \" + url;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 740,
        "wires": [
            [
                "569b327c238cb57e",
                "24cc0fe57e4c17ba"
            ]
        ]
    },
    {
        "id": "4bae3eb5a8024f98",
        "type": "link out",
        "z": "7497b37a51b0ccd4",
        "name": "link out 42",
        "mode": "link",
        "links": [
            "aac2c9106397b469"
        ],
        "x": 1335,
        "y": 740,
        "wires": []
    },
    {
        "id": "e32d095189265dfb",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "Result",
        "func": "flow.set(\"busy\",false);\n\nif( msg.payload.code !== 0 ) {  //\n    flow.set(\"message\",\"Error: Firmware download failed\");\n    node.send([msg,null]);\n    return \n}\n\nflow.set(\"message\",\"Firmware \" + flow.get(\"latest\") + \" downloaded\");\nflow.set(\"downloaded\",flow.get(\"latest\"));\nmsg.payload =  flow.get(\"latest\");\nnode.send([null,msg]);\n\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 820,
        "wires": [
            [
                "59720ee692de3a93"
            ],
            [
                "ea38537980e4336d"
            ]
        ]
    },
    {
        "id": "ea38537980e4336d",
        "type": "file",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "",
        "filename": "sdcard/firmware/ver.txt",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 800,
        "y": 840,
        "wires": [
            [
                "59720ee692de3a93"
            ]
        ]
    },
    {
        "id": "7b7b65da348de6b9",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "name": "Message",
        "func": "var device = flow.get(\"device\");\n\nmsg.topic =\"axis/upgrade/\" + device.serial;\nmsg.payload = {\n    message: \"Error: \" + msg.error.message,\n    group: flow.get(\"group\") || \"Undefined\",\n    location: flow.get(\"location\") || \"Undefined\",\n    serial: device.serial, \n    model: device.model,\n    firmware: device.firmware,\n    downloaded: flow.get(\"downloaded\"),\n    latest:  flow.get(\"latest\"),\n    timestamp: new Date().getTime()\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 140,
        "wires": [
            [
                "6142429506edebf5",
                "e0aada17e9d47e81"
            ]
        ]
    },
    {
        "id": "c7fca5bbc836d051",
        "type": "mqtt in",
        "z": "7497b37a51b0ccd4",
        "name": "",
        "topic": "axis/upgrade",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "de0debe784ae927d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 980,
        "wires": [
            [
                "0b4845eb00c1a767"
            ]
        ]
    },
    {
        "id": "0b4845eb00c1a767",
        "type": "function",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "Check to see if upgrade applies",
        "func": "if( flow.get(\"busy\") )\n    return;\n\nif( flow.get(\"device\").firmware === flow.get(\"latest\"))\n    return;\n\nif( msg.payload.hasOwnProperty(\"location\") )\n    if( flow.get(\"location\") != msg.payload.location)\n        return;\n\nif( msg.payload.hasOwnProperty(\"group\") )\n    if( flow.get(\"group\") != msg.payload.group)\n        return;\n\nif( msg.payload.hasOwnProperty(\"model\") )\n    if( flow.get(\"device\").model != msg.payload.model )\n        return;\n\nif( msg.payload.hasOwnProperty(\"serial\") ) {\n    if( typeof msg.payload.serial === \"string\") {\n        if( msg.payload.serial !== flow.get(\"device\").serial) \n            return;\n    } else {\n        if( Array.isArray(msg.payload.serial) ) {\n            var match = false;\n            msg.payload.serial.forEach(function(item){\n                if( item === flow.get(\"device\").serial)\n                    match = true;\n            });\n            if( !match )\n                return;\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 980,
        "wires": [
            [
                "51babea9b53c89bd"
            ]
        ]
    },
    {
        "id": "51babea9b53c89bd",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Firmware upgrade started",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "true",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 980,
        "wires": [
            [
                "b03989c79406b6de",
                "ea657e9184231e0e"
            ]
        ]
    },
    {
        "id": "390b878838b858a3",
        "type": "link out",
        "z": "7497b37a51b0ccd4",
        "name": "link out 43",
        "mode": "link",
        "links": [
            "aac2c9106397b469"
        ],
        "x": 1335,
        "y": 980,
        "wires": []
    },
    {
        "id": "707e071d175e7175",
        "type": "comment",
        "z": "7497b37a51b0ccd4",
        "name": "Status",
        "info": "",
        "x": 1230,
        "y": 740,
        "wires": []
    },
    {
        "id": "d70b24cb46da959b",
        "type": "comment",
        "z": "7497b37a51b0ccd4",
        "name": "Status",
        "info": "",
        "x": 1230,
        "y": 980,
        "wires": []
    },
    {
        "id": "ea657e9184231e0e",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "Firmware file",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "sdcard/firmware/firmware.bin",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "filename",
                "pt": "msg",
                "to": "sdcard/firmware/firmware.bin",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 1040,
        "wires": [
            [
                "756bb201fc53da66"
            ]
        ]
    },
    {
        "id": "756bb201fc53da66",
        "type": "Axis device",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "",
        "preset": "a5d60ef5587cc8fc",
        "action": "Upgrade firmware",
        "cgi": "",
        "data": "",
        "options": "",
        "filename": "",
        "x": 630,
        "y": 1040,
        "wires": [
            [
                "24d4c191cdb02d9f"
            ]
        ]
    },
    {
        "id": "24d4c191cdb02d9f",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Upgrade complete.  Restarting.",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "false",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1040,
        "wires": [
            [
                "b03989c79406b6de"
            ]
        ]
    },
    {
        "id": "a508a750a3a8906c",
        "type": "catch",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "",
        "scope": [
            "756bb201fc53da66"
        ],
        "uncaught": false,
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "d8d1a3786ddca838"
            ]
        ]
    },
    {
        "id": "d8d1a3786ddca838",
        "type": "change",
        "z": "7497b37a51b0ccd4",
        "g": "f2b7a7fd2d8ff58f",
        "name": "Message",
        "rules": [
            {
                "t": "set",
                "p": "message",
                "pt": "flow",
                "to": "Error: Upgrade failed.",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "busy",
                "pt": "flow",
                "to": "false",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1100,
        "wires": [
            [
                "b03989c79406b6de"
            ]
        ]
    },
    {
        "id": "42c601865ffb888f",
        "type": "comment",
        "z": "7497b37a51b0ccd4",
        "name": "Version 1.0.0",
        "info": "",
        "x": 170,
        "y": 40,
        "wires": []
    },
    {
        "id": "2ee1f4f830ca9548",
        "type": "random",
        "z": "7497b37a51b0ccd4",
        "g": "a34aee74e091cd2b",
        "name": "",
        "low": "1000",
        "high": "21600000",
        "inte": "true",
        "property": "payload",
        "x": 620,
        "y": 680,
        "wires": [
            [
                "c9a7e43d8ae16952"
            ]
        ]
    },
    {
        "id": "694d41a6b0620652",
        "type": "inject",
        "z": "7497b37a51b0ccd4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 740,
        "wires": [
            [
                "3215c31d0b13680e"
            ]
        ]
    },
    {
        "id": "de0debe784ae927d",
        "type": "mqtt-broker",
        "name": "MQTT Broker",
        "broker": "10.13.8.20",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "a5d60ef5587cc8fc",
        "type": "Device Access",
        "name": "Localhost",
        "address": "localhost",
        "protocol": "http"
    }
]

[{"id":"c48beb10.e56f58","type":"http request","z":"51af1286.98523c","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"http://www.axis.com/api/pia/v2/items?type=Product&categories=cameras,fixeddome,fixed,ptz,encoders,pac,speakers,radardetectors,doorcontrollers,bridges&includeSubcategories=false&includeProperties=true&includeLargeTextValues=false","tls":"","proxy":"","x":450,"y":100,"wires":[["babdff10.8afc5"]]},{"id":"f614d05f.e8d6e","type":"function","z":"51af1286.98523c","name":"API Key","func":"//\"Authorization: Token token=\\\"yourtoken\\\"\" \nmsg.headers = {};\nmsg.headers['Content-type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json;charset=utf-8';\nmsg.headers['Authorization'] = 'apikey da6cac02-e554-44c5-8125-1281982c3cdb';\nreturn msg;\n","outputs":1,"noerr":0,"x":240,"y":100,"wires":[["c48beb10.e56f58"]]},{"id":"babdff10.8afc5","type":"function","z":"51af1286.98523c","name":"Process Device List","func":"function platform( chip ) {\n    switch( chip ) {\n        case 'ARTPEC-2': return 'ETRAX';\n        case 'ARTPEC-3': return 'chrisv32';\n        case 'ARTPEC-4': return 'mips';\n        case 'ARTPEC-5': return 'mips';\n        case 'ARTPEC-6': return 'armv7hf';\n        case 'ARTPEC-7': return 'armv7hf';\n        case 'A5S': return 'armv6';\n        case 'S2': return 'armv7';\n        case 'S2L': return 'armv7hf';\n        case 'S2E': return 'armv7hf';\n        case 'S2E': return 'armv7hf';\n        case 'S3L': return 'armv7hf';\n        case 'S3E': return 'armv7hf';\n        default: return '';\n    }\n}\n\nvar piaList = msg.payload;\nvar list = [];\nfor( var i = 0; i < piaList.length; i++) {\n    var device = {}\n    device.id = piaList[i].id;\n    device.name = piaList[i].hasOwnProperty(\"name\") ?  piaList[i].name.split('-')[0]:\"\";\n    device.name = device.name.substr(5,10);\n    device.type = piaList[i].hasOwnProperty(\"type\") ? piaList[i].type:\"\";\n    device.category = piaList[i].hasOwnProperty(\"category\") ? piaList[i].category:\"\";\n    device.release =  piaList[i].properties.hasOwnProperty(\"externalReleaseDate\") ? piaList[i].properties.externalReleaseDate.split(' ')[0].split('-')[0]:\"\";\n    device.chip = piaList[i].properties.hasOwnProperty(\"platform\") ?  piaList[i].properties.platform:\"\";\n    device.platform = platform( device.chip );\n    device.resolution = piaList[i].properties.hasOwnProperty(\"maxVideoResMotionJPEG\") ?  piaList[i].properties.maxVideoResMotionJPEG:\"\";\n    device.product = piaList[i].properties.hasOwnProperty(\"cnProdType\") ?  piaList[i].properties.cnProdType:\"\";\n    device.firmware = piaList[i].properties.hasOwnProperty(\"latestFirmwareVersion\") ?  piaList[i].properties.latestFirmwareVersion:\"\";\n    device.firmware = device.firmware.substr(0,12);\n    device.ram = piaList[i].properties.hasOwnProperty(\"afiRAM\") ?  piaList[i].properties.afiRAM:\"\";\n    if( device.release > \"2008\") {\n        var found = false;\n        for( var p = 0; p < list.length; p++ )\n            if( list[p].name == device.name )\n                found = true;\n        if( !found )\n            list.push( device );\n    }\n}\n\nmsg.payload = list;\nflow.set(\"products\",list);\nreturn msg;\n","outputs":1,"noerr":0,"x":660,"y":100,"wires":[["e9ff534a.c2b5a"]]}]
